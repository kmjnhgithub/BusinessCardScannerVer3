# 測試指南

本文件提供 BusinessCardScanner 專案的詳細測試方法、參考資料和最佳實踐。

## 📋 目錄

- [手動測試流程](#手動測試流程)
- [測試環境設定](#測試環境設定)
- [詳細測試項目](#詳細測試項目)
- [測試報告格式](#測試報告格式)
- [階段完成標準](#階段完成標準)
- [測試最佳實踐](#測試最佳實踐)
- [故障排除指南](#故障排除指南)

## 手動測試流程

### 為什麼使用手動測試？

**重要：** 本專案採用手動測試方式，因為：
- 相機拍照功能無法自動化測試
- OCR 識別需要真實影像驗證
- 使用者互動體驗需要人工確認
- 權限請求流程需要手動操作

### 測試執行步驟

#### 1. 建置驗證
```bash
# 確保專案可以正常編譯
xcodebuild build -project /Users/mikeliu/Documents/iOS/BusinessCardScannerVer3/BusinessCardScannerVer3.xcodeproj -scheme BusinessCardScannerVer3 -sdk iphonesimulator
```

#### 2. 測試環境準備
- **模擬器測試**: 使用 iPhone 16 模擬器進行基本功能測試
- **真機測試**: 必須使用真機測試相機、OCR、效能等功能
- **測試資料**: 準備各種格式的名片樣本

#### 3. 階段式測試流程
1. 按照 CLAUDE.md 中 "Current Development Status" 的測試清單
2. 逐項驗證每個功能模組
3. 記錄測試結果和發現的問題
4. 提交測試報告

## 測試環境設定

### 建議測試環境

**模擬器測試 (基本功能):**
- iOS 模擬器 iPhone 16
- iOS 版本: 18.0+
- 記憶體: 充足的模擬器記憶體設定

**真機測試 (核心功能):**
- 實體 iPhone (建議 iPhone 12 以上)
- iOS 版本: 15.0+
- 相機功能正常
- 足夠的儲存空間

**多版本測試:**
- 不同 iOS 版本 (15.0, 16.0, 17.0, 18.0)
- 不同螢幕尺寸 (iPhone SE, iPhone 16, iPhone 16 Pro Max)
- 不同網路環境 (WiFi, 4G/5G, 無網路)

### 測試資料準備

**名片樣本:**
- 中文名片 (繁體、簡體)
- 英文名片
- 中英混合名片
- 不同設計風格的名片
- 不同品質的照片 (清晰、模糊、光線不足)

**特殊情況測試資料:**
- 特殊字體的名片
- 深色背景名片
- 複雜排版的名片
- 小字體名片
- 手寫字體名片

## 詳細測試項目

### 1. 權限測試

#### 相機權限
- [ ] 首次啟動應用程式時的相機權限請求
- [ ] 權限描述文字正確顯示 (中文說明)
- [ ] 拒絕權限後的處理流程
- [ ] 從設定重新開啟權限的提示
- [ ] 權限狀態變更的即時響應

#### 相簿權限
- [ ] 相簿權限請求流程
- [ ] 權限描述文字正確顯示
- [ ] 拒絕權限後的錯誤處理
- [ ] 部分權限 (選定照片) 的處理

### 2. 相機功能測試

#### 基本拍照功能
- [ ] 相機介面正常啟動
- [ ] 相機預覽畫面顯示正常
- [ ] 拍照按鈕響應正常
- [ ] 拍照聲音和震動回饋
- [ ] 照片品質符合預期

#### 相機UI測試
- [ ] CameraGuideView 動畫效果
- [ ] 掃描框顯示正確
- [ ] 取消按鈕功能正常
- [ ] 介面旋轉適配
- [ ] 不同光線環境下的表現

#### 錯誤處理
- [ ] 相機無法啟動的錯誤處理
- [ ] 儲存空間不足的處理
- [ ] 相機硬體故障的處理

### 3. 相簿選擇測試

#### PHPickerViewController 整合
- [ ] 相簿介面正常顯示
- [ ] 照片選擇功能正常
- [ ] 取消選擇的處理
- [ ] 大圖片檔案的處理
- [ ] 不支援格式的錯誤處理

#### 相簿權限處理
- [ ] 完整相簿存取權限
- [ ] 部分照片存取權限
- [ ] 拒絕存取的錯誤處理

### 4. OCR 識別測試

#### 基本識別功能
- [ ] 中文文字識別準確度
- [ ] 英文文字識別準確度
- [ ] 數字識別準確度
- [ ] 特殊符號識別
- [ ] 混合語言識別

#### 識別品質測試
- [ ] 清晰照片的識別效果
- [ ] 模糊照片的處理
- [ ] 光線不足照片的處理
- [ ] 角度傾斜照片的處理
- [ ] 背景複雜照片的處理

#### 欄位提取測試
- [ ] 姓名欄位提取準確度
- [ ] 公司名稱提取準確度
- [ ] 職位提取準確度
- [ ] 電話號碼提取和格式化
- [ ] 電子郵件提取準確度
- [ ] 地址提取準確度
- [ ] 網站 URL 提取準確度

#### 效能測試
- [ ] 識別處理時間 (應在 3-5 秒內)
- [ ] 記憶體使用量
- [ ] 電池消耗情況
- [ ] 多次連續識別的穩定性

### 5. 編輯功能測試

#### 表單顯示
- [ ] ContactEditViewController 正常顯示
- [ ] 各欄位預填入識別結果
- [ ] 照片顯示正確
- [ ] 輸入欄位佈局正確

#### 輸入驗證
- [ ] 姓名欄位驗證
- [ ] 電話號碼格式驗證
- [ ] 電子郵件格式驗證
- [ ] 必填欄位提示
- [ ] 字數限制驗證

#### 照片管理
- [ ] 照片顯示和縮放
- [ ] 照片替換功能
- [ ] 照片刪除功能
- [ ] 照片儲存品質

#### 儲存功能
- [ ] 儲存按鈕響應
- [ ] 資料正確儲存到 Core Data
- [ ] 照片檔案正確儲存
- [ ] 儲存成功提示

#### 取消功能
- [ ] 取消按鈕響應
- [ ] 未儲存資料的提示
- [ ] 返回上一頁正常

### 6. 列表功能測試

#### 列表顯示
- [ ] BusinessCardCell 正常顯示
- [ ] 名片資料顯示完整
- [ ] 縮圖照片顯示正確
- [ ] 空列表狀態顯示

#### 搜尋功能
- [ ] 搜尋欄位響應正常
- [ ] 即時搜尋結果更新
- [ ] 中文搜尋功能
- [ ] 英文搜尋功能
- [ ] 清除搜尋功能

#### 列表操作
- [ ] 滑動刪除功能
- [ ] 刪除確認對話框
- [ ] 下拉更新功能
- [ ] 列表項目點擊響應

#### Combine 資料流測試
- [ ] 搜尋文字變更的響應速度
- [ ] 資料一致性 (cards ↔ filteredCards)
- [ ] 記憶體洩漏檢查

### 7. 導航流程測試

#### TabBar 導航
- [ ] TabBar 正常顯示
- [ ] Tab 切換流暢度
- [ ] 相機 Tab 攔截功能
- [ ] Tab 圖示和文字正確

#### 頁面導航
- [ ] 頁面推入和彈出動畫
- [ ] 導航標題正確顯示
- [ ] 返回按鈕功能正常
- [ ] 深層導航狀態管理

#### Coordinator 模式
- [ ] 模組間導航正確
- [ ] 記憶體管理正確
- [ ] 循環引用檢查

### 8. 完整流程測試

#### 端到端流程
- [ ] **拍照→識別→編輯→儲存** 完整流程
- [ ] **相簿→識別→編輯→儲存** 完整流程  
- [ ] **手動輸入→編輯→儲存** 完整流程
- [ ] **列表→搜尋→管理** 完整流程

#### 錯誤恢復測試
- [ ] 中途取消操作的處理
- [ ] 應用程式背景/前景切換
- [ ] 記憶體不足時的處理
- [ ] 網路連線中斷的處理

## 測試報告格式

### 標準測試報告模板

```markdown
## Phase X 測試報告

**測試環境：** iOS 模擬器 / 真機 (請註明型號和 iOS 版本)
**測試日期：** YYYY-MM-DD
**測試人員：** [姓名]

### 通過項目：
- [x] 功能項目 1 - 正常運作
- [x] 功能項目 2 - 正常運作

### 失敗項目：
- [ ] 功能項目 3 - 問題描述
- [ ] 功能項目 4 - 問題描述

### 發現問題：
1. **問題標題**
   - **重現步驟：** 
     1. 步驟 1
     2. 步驟 2
     3. 步驟 3
   - **預期結果：** 應該發生什麼
   - **實際結果：** 實際發生什麼
   - **嚴重程度：** 高/中/低
   - **建議修正：** 修正建議

### 效能數據：
- **OCR 識別時間：** X.X 秒
- **記憶體使用量：** XXX MB
- **啟動時間：** X.X 秒

### 整體評估：** 
- [ ] 通過 - 可以進入下一階段
- [ ] 需要修正 - 有問題需要解決
- [ ] 重大問題 - 必須修正才能繼續

### 建議與備註：
[其他建議和備註]
```

## 階段完成標準

### 每階段必須達到的標準

#### ✅ 功能性標準
- 所有測試項目通過
- 核心功能運作正常
- 錯誤處理機制完善
- 資料一致性維持

#### ✅ 效能標準
- OCR 識別時間 < 5 秒
- 啟動時間 < 3 秒
- 記憶體使用合理
- 無明顯卡頓現象

#### ✅ 使用者體驗標準
- 介面響應迅速
- 操作流程直觀
- 錯誤提示清楚
- 視覺設計一致

#### ✅ 穩定性標準
- 無應用程式崩潰
- 記憶體洩漏檢查通過
- 長時間使用穩定
- 異常情況處理良好

### 階段進入條件

只有達到以下標準才能進入下一階段：
1. **所有測試項目通過**
2. **無重大功能性問題**
3. **效能指標達標**
4. **使用者體驗良好**
5. **測試報告完整**

## 測試最佳實踐

### 測試前準備

#### 環境準備
1. 確保測試裝置電量充足
2. 清理裝置儲存空間
3. 關閉不必要的背景應用程式
4. 準備測試資料和名片樣本

#### 測試計劃
1. 制定詳細的測試計劃
2. 分配足夠的測試時間
3. 準備測試檢查清單
4. 設定測試環境

### 測試執行技巧

#### 系統性測試
1. 按照檢查清單逐項測試
2. 記錄每個測試項目的結果
3. 重現發現的問題
4. 拍攝問題截圖或錄影

#### 邊界條件測試
1. 測試極限情況 (大檔案、複雜名片)
2. 測試錯誤輸入
3. 測試網路異常情況
4. 測試裝置資源不足情況

### 問題報告技巧

#### 有效的問題描述
1. 清楚的問題標題
2. 詳細的重現步驟
3. 明確的預期和實際結果
4. 相關的截圖或錄影
5. 裝置和環境資訊

#### 問題分類
- **功能性問題**: 功能無法正常運作
- **效能問題**: 速度或資源使用問題
- **UI/UX 問題**: 介面或使用體驗問題
- **相容性問題**: 不同裝置或系統版本問題

## 故障排除指南

### 常見問題和解決方案

#### 1. 相機無法啟動
**可能原因:**
- 權限未授予
- 相機硬體問題
- 其他應用程式占用相機

**解決方案:**
- 檢查權限設定
- 重啟應用程式
- 檢查其他相機應用程式

#### 2. OCR 識別不準確
**可能原因:**
- 照片品質不佳
- 光線不足
- 文字過小或模糊

**解決方案:**
- 改善拍照環境
- 調整拍照角度
- 使用更高品質的照片

#### 3. 應用程式崩潰
**可能原因:**
- 記憶體不足
- 未處理的異常
- 並發問題

**解決方案:**
- 重啟應用程式
- 檢查記憶體使用量
- 檢查日誌記錄

#### 4. 資料不同步
**可能原因:**
- Combine 管道問題
- Core Data 同步問題
- 並發存取問題

**解決方案:**
- 檢查資料流設計
- 驗證同步機制
- 測試並發情況

### 除錯工具和技巧

#### Xcode 除錯
- 使用 Xcode 的除錯器
- 檢查記憶體使用量
- 分析效能瓶頸
- 查看 Core Data 資料

#### 日誌分析
- 檢查控制台日誌
- 分析錯誤訊息
- 追蹤執行流程

#### 效能分析
- 使用 Instruments 工具
- 分析記憶體洩漏
- 檢查 CPU 使用量
- 分析網路請求

## 自動化測試參考 (歷史參考)

### 先前自動化測試的參考準則

雖然現在使用手動測試，但以下是先前自動化測試的參考準則，可作為手動測試的檢查點：

#### 1. State Verification
手動驗證資料一致性，特別是 cards ↔ filteredCards 的同步

#### 2. Combine Pipeline
注意 Publisher 初始化時間，手動操作時允許適當延遲 (約 0.2 秒)

#### 3. Permission Flow
手動測試完整的權限請求和設定引導流程

#### 4. OCR Performance
手動監控識別時間和信心度分數

#### 5. Field Extraction
手動驗證各種名片欄位的正確擷取

#### 6. Multi-language
手動測試中英文名片識別的準確度

### 架構驗證參考

專案架構的驗證和學習可參考以下實際實現：

- **導航協調器模式**: 參考 `Features/*/Coordinators/` 中的實際實現
- **Combine 資料一致性**: 參考 `Features/CardList/CardListViewModel.swift` 中的 Publisher 使用
- **AlertPresenter 整合**: 參考 `Core/Common/UI/Presenters/AlertPresenter.swift` 使用範例
- **權限管理模式**: 參考 `Core/Services/PermissionManager.swift` 實現
- **相機 UI 實現**: 參考 `Features/CardCreation/Camera/` 中的實際代碼
- **OCR 整合模式**: 參考 `Features/CardCreation/OCRProcessor.swift` 實現
- **PhotoService 模式**: 參考 `Core/Services/PhotoService.swift` 實現

這些實際的實現代碼是最佳的架構學習和故障排除參考。

---

## 總結

這份測試指南提供了完整的手動測試方法和最佳實踐。透過系統性的測試流程，可以確保 BusinessCardScanner 專案的品質和穩定性。

記住，測試不僅是為了發現問題，更是為了確保使用者獲得最佳的體驗。每個階段的thorough測試都是為下一階段開發奠定堅實基礎的重要步驟。