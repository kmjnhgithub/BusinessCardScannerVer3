# 修復歷史記錄

本文件記錄了 BusinessCardScanner 專案的問題修復歷史。

## 2025-01-03 修復項目

### Issue 7: 編輯按鈕無法點選 (✅ 已修復)
**問題描述**: 
- 既有名片進入檢視模式後，右上角的編輯按鈕呈現灰色且無法點選

**根本原因**:
1. `CardCreationCoordinator.start()` 沒有檢查 `editingCard` 參數
2. `ContactEditViewController` 的 `isSaveEnabled` 綁定會覆蓋所有 NavigationBar 按鈕狀態

**修復方案**:
1. 在 `CardCreationCoordinator.start()` 開頭檢查 `editingCard`，如果存在則直接調用 `showEditForm(for:)`
2. 修改 `isSaveEnabled` 綁定邏輯，只在非檢視模式時更新 NavigationBar 按鈕
3. 在 `updateNavigationBarForState()` 中明確設置編輯按鈕為啟用狀態

**修改檔案**:
- `CardCreationCoordinator.swift` (第 44-63 行)
- `ContactEditViewController.swift` (第 315-327 行, 第 491-503 行)

### Issue 8: 手動輸入照片選擇觸發 OCR (✅ 已修復)
**問題描述**: 
- 手動輸入模式下選擇照片（相機/相簿）仍會觸發 OCR 處理

**根本原因**:
- 手動輸入模式未區分照片選擇流程，所有照片都會進入 `processSelectedImage` 進行 OCR

**修復方案**:
1. 在 `cameraViewController:didCaptureImage:` 中檢查 `sourceType == .manual`
2. 在 `picker:didFinishPicking:` 中檢查是否為手動輸入或編輯頁面
3. 符合條件時直接調用 `updateEditViewPhoto()` 而非 `processSelectedImage()`

**修改檔案**:
- `CardCreationCoordinator.swift` (第 364-381 行, 第 524-561 行)

## 2025-07-03 修復項目

### Issue 3: 電話和手機號碼識別 (✅ 已修復)
- 修正電話號碼格式化邏輯
- 改善手機號碼識別準確度

### Issue 4: 資料持久化問題 (✅ 已修復)
- 修復 Core Data 儲存邏輯
- 確保資料正確載入

### Issue 5: 相簿選擇導航錯誤 (✅ 已修復)
- 修正 PhotoPickerCoordinator 的導航邏輯
- 解決記憶體管理問題

### Issue 6: FormFieldView Auto Layout 約束衝突 (✅ 已修復)
- 修復約束優先級設定
- 解決 translatesAutoresizingMaskIntoConstraints 設定問題